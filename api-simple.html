
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>module_i2c_simple &mdash;  2v0 documentation</title>
    <link rel="stylesheet" href="_static/xdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '2v0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://mathjax.connectmv.com/MathJax.js"></script>
    <script type="text/javascript" src="_static/xcomment.js"></script>
    <link rel="top" title=" 2v0 documentation" href="index.html" />
    <link rel="next" title="module_i2c_master" href="api-master.html" />
    <link rel="prev" title="I2C interface" href="summary.html" /> 

<script>
function setheight() {
h1 = document.getElementById('d1').style.height;
h2 = document.getElementById('d2').style.height;

if (parseInt(h1) > parseInt(h2)) {
document.getElementById('d2').style.height=h1 + "px";
}
else {
document.getElementById('d1').style.height=h2 + "px";
}

}
</script>
</head>

<body onload="setheight();">

  

    <div class="document" id='d1'>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
<div style="float: right">
<a href="summary.html"
                        title="previous chapter"> &lt&lt </a>
<a href="api-master.html"
                        title="next chapter"> &gt&gt </a></p>
</div>

            
  <div class="section" id="module-i2c-simple">
<h1>module_i2c_simple<a class="headerlink" href="#module-i2c-simple" title="Permalink to this headline">¶</a></h1>
<p>This I2C module comprises four functions that implement I2C master. It is a
small and simple version of the protocol with limitations (described
below), a full version with a compatible interface is available in
<tt class="docutils literal"><span class="pre">module_i2c_master</span></tt>, but is has a bigger memory footprint.</p>
<p>The three restrictions of this module are:</p>
<ol class="arabic simple">
<li>It does not implement clock-stretching: it should only be used when
slaves do not attempt to stretch the clock.</li>
<li>It does not implement multi-master: it should only be used when the
XCore is the only master on the I2C bus.</li>
<li>The speed of the bus is defined using a compile-time define
(<tt class="docutils literal"><span class="pre">I2C_BIT_TIME</span></tt>), and when using this module with multiple I2C busses
they will all run at the same speed.</li>
</ol>
<div class="section" id="symbolic-constants">
<h2>Symbolic constants<a class="headerlink" href="#symbolic-constants" title="Permalink to this headline">¶</a></h2>
<dl class="macro">
<dt id="I2C_BIT_TIME">
<tt class="descname">I2C_BIT_TIME</tt><a class="headerlink" href="#I2C_BIT_TIME" title="Permalink to this definition">¶</a></dt>
<dd><p>This constant defines the time in clock ticks between successive bits.</p>
<p>By default set to 1000 for 100 Kbit devices, but it can be overriden to 250 for 400 Kbit devices.</p>
</dd></dl>

</div>
<div class="section" id="types">
<h2>Types<a class="headerlink" href="#types" title="Permalink to this headline">¶</a></h2>
<dl class="type">
<dt id="r_i2c">
<tt class="descname">r_i2c</tt><a class="headerlink" href="#r_i2c" title="Permalink to this definition">¶</a></dt>
<dd><p>Struct that holds the data for instantiating the I2C module - it just comprises two ports (the clock port and the data port), the only other settable parameter is the speed of the bus which is a compile time define.</p>
<p><strong>Structure Members:</strong></p>
<dl class="member">
<dt id="r_i2c.scl">
port <tt class="descname">scl</tt><a class="headerlink" href="#r_i2c.scl" title="Permalink to this definition">¶</a></dt>
<dd><p>Port on which clock wire is attached.</p>
<p>Must be on bit 0</p>
</dd></dl>

<dl class="member">
<dt id="r_i2c.sda">
port <tt class="descname">sda</tt><a class="headerlink" href="#r_i2c.sda" title="Permalink to this definition">¶</a></dt>
<dd><p>Port on which data wire is attached.</p>
<p>Must be on bit 0</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="api">
<h2>API<a class="headerlink" href="#api" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="i2c_master_init">
void <tt class="descname">i2c_master_init</tt><big>(</big>struct <a class="reference internal" href="#r_i2c" title="r_i2c"><span>r_i2c</span></a><em>&nbsp;&amp;i2c</em><big>)</big><a class="headerlink" href="#i2c_master_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that initialises the ports on an I2C device.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>i2c_master</strong> &#8211; struct containing the clock and data ports. Both should be declared as unbuffered bidirectional ports.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="i2c_master_rx">
int <tt class="descname">i2c_master_rx</tt><big>(</big>int<em>&nbsp;device</em>, unsigned char<em>&nbsp;data[]</em>, int<em>&nbsp;nbytes</em>, struct <a class="reference internal" href="#r_i2c" title="r_i2c"><span>r_i2c</span></a><em>&nbsp;&amp;i2c</em><big>)</big><a class="headerlink" href="#i2c_master_rx" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that reads data from an I2C device.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>device</strong> &#8211; Bus address of device, even number between 0x00 and 0xFE.</li>
<li><strong>data</strong> &#8211; Array where data is stored.</li>
<li><strong>nbytes</strong> &#8211; Number of bytes to read and store in data. This parameter must be set to &#8216;1&#8217; and is ignored in this module. This parameter is provided for compatibililty with module_i2c_master.</li>
<li><strong>i2c</strong> &#8211; struct containing the clock and data ports. Both should be declared as unbuffered bidirectional ports.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="i2c_master_read_reg">
int <tt class="descname">i2c_master_read_reg</tt><big>(</big>int<em>&nbsp;device</em>, int<em>&nbsp;reg_addr</em>, unsigned char<em>&nbsp;data[]</em>, int<em>&nbsp;nbytes</em>, struct <a class="reference internal" href="#r_i2c" title="r_i2c"><span>r_i2c</span></a><em>&nbsp;&amp;i2c_master</em><big>)</big><a class="headerlink" href="#i2c_master_read_reg" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that reads a register from an I2C device.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>device</strong> &#8211; Bus address of device, even number between 0x00 and 0xFE.</li>
<li><strong>reg_addr</strong> &#8211; Address of register to read, value between 0x00 and 0x7F.</li>
<li><strong>data</strong> &#8211; Array where data is stored.</li>
<li><strong>nbytes</strong> &#8211; Number of bytes to read and store in data. This parameter must be set to &#8216;1&#8217; and is ignored in this module. This parameter is provided for compatibililty with module_i2c_master.</li>
<li><strong>i2c_master</strong> &#8211; struct containing the clock and data ports. Both should be declared as unbuffered bidirectional ports.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="i2c_master_write_reg">
int <tt class="descname">i2c_master_write_reg</tt><big>(</big>int<em>&nbsp;device</em>, int<em>&nbsp;reg_addr</em>, unsigned char<em>&nbsp;data[]</em>, int<em>&nbsp;nbytes</em>, struct <a class="reference internal" href="#r_i2c" title="r_i2c"><span>r_i2c</span></a><em>&nbsp;&amp;i2c_master</em><big>)</big><a class="headerlink" href="#i2c_master_write_reg" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that writes to a register on an I2C device.</p>
<p>Note that this function uses the same interface as module_i2c but that the fields master_num and clock_mul are ignored by this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>device</strong> &#8211; Bus address of device, even number between 0x00 and 0xFE.</li>
<li><strong>reg_addr</strong> &#8211; Address of register to write to, value between 0x00 and 0x7F.</li>
<li><strong>data</strong> &#8211; Array where data is stored.</li>
<li><strong>nbytes</strong> &#8211; Number of bytes to read and store in data. This parameter must be set to &#8216;1&#8217; and is ignored in this module. This parameter is provided for compatibililty with module_i2c_master.</li>
<li><strong>i2c_master</strong> &#8211; struct containing the clock and data ports. Both should be declared as unbuffered bidirectional ports.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<p>An example program is shown below. Two unbuffered undirectional ports must be
declared. Neither should be configured. In this example, SCL is
connected to the lowest bit of port 4C, and SDA is connected to port 1G:</p>
<div class="highlight-none"><div class="highlight"><pre>#include &lt;stdio.h&gt;
#include &lt;xs1.h&gt;
#include &quot;i2c.h&quot;

struct r_i2c i2cPorts = {
    XS1_PORT_4C,
    XS1_PORT_1G,
};
</pre></div>
</div>
<p>The main program calls <tt class="docutils literal"><span class="pre">_read_reg</span></tt> and <tt class="docutils literal"><span class="pre">_write_reg</span></tt> as appropriate:</p>
<div class="highlight-none"><div class="highlight"><pre>int main(void) {
    unsigned char data[10];
    
    i2c_master_init(i2cPorts);
    data[0] = 0x12;
    i2c_master_write_reg(0x90, 0x07, data, 1, i2cPorts);
    data[0] = 0x78;
    i2c_master_write_reg(0x90, 0x08, data, 1, i2cPorts);
    i2c_master_read_reg(0x90, 0x07, data, 1, i2cPorts);
    printf(&quot;0x%02x (should be 0x12)\n&quot;, data[0]);
    return 0;
}
</pre></div>
</div>
</div>
</div>



          </div>
        </div>
      </div>
      <div class="sphinxsidebar" id='d2'>
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html"> (2v0)</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="summary.html">I2C interface</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">module_i2c_simple</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#symbolic-constants">Symbolic constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="#types">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="#api">API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api-master.html">module_i2c_master</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-full.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-full.html#programming-guide">Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-full.html#resource-usage">Resource Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-full.html#timing-constraints">Timing Constraints</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-full.html#validation">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-single-port.html">module_i2c_simple</a></li>
</ul>

<div id="searchbox" style="display: none;margin-bottom: 10px;">
  <h3>Search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>



    <div class="footer">
    </div>
  </body>
</html>



